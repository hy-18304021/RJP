create table testuser
(
	username VARCHAR2(20),
	password VARCHAR2(20),
	mail_address VARCHAR2(20)
);

//更新して！
//thread_idを増やした。
create table testres
(
	username VARCHAR2(20) DEFAULT '名無しさん',
	coment VARCHAR2(4000),
	comenttime DATE DEFAULT SYSDATE,
	comentnumber NUMBER,
	threadname VARCHAR2(20),
	thread_id NUMBER
);



///こっちが本命
create table testthread
(
	creator VARCHAR2(20),
	title VARCHAR2(20),
	titleSentence VARCHAR2(2000),
	thread_id NUMBER,
	reply_nb NUMBER,
	created_date DATE,
	last_update DATE,
	visual VARCHAR(20) default 'true'	
);

///自分が作ったすべてのテーブル名を検索
SELECT TABLE_NAME FROM USER_TABLES;

//
insert into testuser(username,password,mail_address) values('aaa','aaa','nozawa0603@gmail.com');

insert into testres(username,coment, comentnumber,threadname) values('aaa','aaa',1, '初めてのスレッド');



ここからは自動連番に関するsql
//スレッドに関するシーケンス。このシーケンスは一つでいい。
//シーケンスがあるかどうか。なかったら作る。あったらそれを使う。っている処理が必要になってくる。
//スレッドに関するシーケンスは一つでいいし一つあればいいからデータベース上に作っておけばいいと思う。
//または最初にtestthreadのthread
CREATE SEQUENCE thread_seq START WITH 1 INCREMENT BY 1 NOMAXVALUE;




INSERT INTO testthread (creator,title,titleSentence,thread_id,reply_nb,created_date,last_update ) 
VALUES(文字列,文字列,文字列,thread_seq.nextval,数値,日付,日付); 

//このシーケンスは一つのスレッドに対して1つ作る。だからスレッドを立てた瞬間insertようのスレッド名_seqみたいな
//シーケンスを作る。そのシーケンスをinsertする予定。
//このシーケンス名のthrnameは立てたスレッドの名前にする。
//スレッド名.seqっていうsequenceがあるかどうか。なかったらcreate。あったら利用する。
//testresのスレッド名がリンク先のスレッド名でかつレスナンバーに対してmax()を使う。それで数字が入ればそのスレッドに関するシーケンスは作成されているからそのままシーケンス名.nextvalをインサート。数字が入ってこなければスレッド名.seqというシーケンスを作成してinsertする。
CREATE SEQUENCE thrname_seq
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

INSERT INTO testres (username,coment,comentnumber,threadname) 
VALUES(文字列,文字列,thrname_seq.nextval,文字列); 




レス数に関するsql
//
select count(*) from testres where threadname=スレッド名;
ResultSetのgetInt("カラム名");で取得できると思う。








最終のDB表構造
Mail_address列を消した。
create table board_user
(
	 U_UserName VARCHAR2(50) primary key
	,PassWord   VARCHAR2(20) not null
);


//いったんlastupdateを文字型にする。
create table board_thread
(
	 T_Thread_id number primary key
	,ThreadName  VARCHAR2(100) not null
	,ThreadSentence VARCHAR2(2000)
	,ResCount  number default 0
	,CreatedDate VARCHAR2(60) default sysdate not null
	,LastUpdate  VARCHAR2(60) default sysdate not null
	,T_UserName VARCHAR2(50) not null
	,Visual VARCHAR(20) default 'true'
	,foreign key(T_UserName) references board_user(U_UserName)
);

//Res_idのプライマリーキー外す。
create table board_res
(
	 R_Thread_id number 
	,Res_id number
	,R_UserName VARCHAR2(50) default '名無しさん' not null
	,Res VARCHAR2(2000) not null
	,ResTime VARCHAR2(60) default sysdate not null
	,foreign key(R_Thread_id) references board_thread(T_Thread_id)
);

ALTER TABLE board_thread MODIFY ( ResCount  DEFAULT 0 );




select column_name,data_default
from user_tab_columns
where table_name='board_thread'


INSERT INTO board_thread (t_thread_id,threadname,threadsentence,t_username) 
VALUES(1,'aaa','aaaの説明','aaa'); 

 column threadname format a30
 column  rescount format a3
 column t_username format a8
 
 set numwidth 4;


































